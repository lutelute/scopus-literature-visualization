#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
setup_improved.py - ScopusÊñáÁåÆÂèØË¶ñÂåñ„Ç∑„Çπ„ÉÜ„É† ÊîπËâØÁâàËá™Âãï„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„Çπ„ÇØ„É™„Éó„Éà
‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê„Åã„Çâ„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´„Åæ„Åß„Çí‰∏ÄÂõû„ÅßÂÆå‰∫Ü
"""

import os
import sys
import subprocess
import importlib.util
import venv
import platform
import time

def CIÁí∞Â¢É„ÉÅ„Çß„ÉÉ„ÇØ() -> bool:
    """CIÁí∞Â¢É„Åã„Å©„ÅÜ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ"""
    ci_Áí∞Â¢ÉÂ§âÊï∞ = ['CI', 'GITHUB_ACTIONS', 'TRAVIS', 'CIRCLECI', 'JENKINS_URL']
    return any(os.getenv(var) for var in ci_Áí∞Â¢ÉÂ§âÊï∞)

def ÂÆâÂÖ®„Å™input(„Éó„É≠„É≥„Éó„Éà: str, „Éá„Éï„Ç©„É´„Éà: str = "y", CIÁí∞Â¢É: bool = False) -> str:
    """CIÁí∞Â¢ÉÂØæÂøú„ÅÆÂÆâÂÖ®„Å™inputÈñ¢Êï∞"""
    if CIÁí∞Â¢É:
        print(f"{„Éó„É≠„É≥„Éó„Éà}ÔºàCIÁí∞Â¢É„ÅÆ„Åü„ÇÅËá™ÂãïÈÅ∏Êäû: {„Éá„Éï„Ç©„É´„Éà}Ôºâ")
        return „Éá„Éï„Ç©„É´„Éà
    try:
        return input(„Éó„É≠„É≥„Éó„Éà).lower().strip()
    except (EOFError, KeyboardInterrupt):
        print(f"\nÂÖ•Âäõ„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„Éá„Éï„Ç©„É´„ÉàÂÄ§„Çí‰ΩøÁî®: {„Éá„Éï„Ç©„É´„Éà}")
        return „Éá„Éï„Ç©„É´„Éà

def „Éë„ÉÉ„Ç±„Éº„Ç∏Á¢∫Ë™ç(„Éë„ÉÉ„Ç±„Éº„Ç∏Âêç: str) -> bool:
    """„Éë„ÉÉ„Ç±„Éº„Ç∏„Åå„Ç§„É≥„Çπ„Éà„Éº„É´„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ"""
    spec = importlib.util.find_spec(„Éë„ÉÉ„Ç±„Éº„Ç∏Âêç)
    return spec is not None

def ‰ªÆÊÉ≥Áí∞Â¢ÉPythonÂÆüË°å„Éï„Ç°„Ç§„É´ÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str) -> str:
    """OSÂà•„ÅÆ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖPythonÂÆüË°å„Éï„Ç°„Ç§„É´„Éë„Çπ„ÇíÂèñÂæó"""
    if platform.system() == "Windows":
        return os.path.join(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "Scripts", "python.exe")
    else:
        return os.path.join(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "bin", "python")

def ‰ªÆÊÉ≥Áí∞Â¢ÉpipÂÆüË°å„Éï„Ç°„Ç§„É´ÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str) -> str:
    """OSÂà•„ÅÆ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖpipÂÆüË°å„Éï„Ç°„Ç§„É´„Éë„Çπ„ÇíÂèñÂæó"""
    if platform.system() == "Windows":
        return os.path.join(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "Scripts", "pip.exe")
    else:
        return os.path.join(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "bin", "pip")

def ‰ªÆÊÉ≥Áí∞Â¢É„Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éû„É≥„ÉâÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str) -> str:
    """OSÂà•„ÅÆ‰ªÆÊÉ≥Áí∞Â¢É„Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éû„É≥„Éâ„ÇíÂèñÂæó"""
    if platform.system() == "Windows":
        return f"{‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}\\Scripts\\activate"
    else:
        return f"source {‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}/bin/activate"

def ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„ÉâÁîüÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str, „Ç≥„Éû„É≥„Éâ: str) -> str:
    """OSÂà•„ÅÆ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„Éâ„ÇíÁîüÊàê"""
    if platform.system() == "Windows":
        return f"{‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}\\Scripts\\activate && {„Ç≥„Éû„É≥„Éâ}"
    else:
        return f"source {‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}/bin/activate && {„Ç≥„Éû„É≥„Éâ}"

def ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê„Åä„Çà„Å≥Ë®≠ÂÆö(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str = ".venv", Ëá™ÂãïÂÆüË°å: bool = False) -> bool:
    """‰ªÆÊÉ≥Áí∞Â¢É„ÅÆ‰ΩúÊàê„Å®ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆËá™Âãï„Ç§„É≥„Çπ„Éà„Éº„É´"""
    
    print("[INFO] ‰ªÆÊÉ≥Áí∞Â¢É„Çí„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...")
    
    # ‰ªÆÊÉ≥Áí∞Â¢É„ÅÆÂ≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ
    if os.path.exists(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ):
        print("[OK] ‰ªÆÊÉ≥Áí∞Â¢É„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô")
        venv_python = ‰ªÆÊÉ≥Áí∞Â¢ÉPythonÂÆüË°å„Éï„Ç°„Ç§„É´ÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
        
        if os.path.exists(venv_python):
            print(f"[OK] ‰ªÆÊÉ≥Áí∞Â¢É„ÅÆPythonÂÆüË°å„Éï„Ç°„Ç§„É´Á¢∫Ë™ç: {venv_python}")
        else:
            print(f"[NG] ‰ªÆÊÉ≥Áí∞Â¢É„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂÜç‰ΩúÊàê„Åó„Åæ„Åô...")
            return ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜç‰ΩúÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
    else:
        print("[PKG] ‰ªÆÊÉ≥Áí∞Â¢É„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ‰ΩúÊàê„Åó„Åæ„Åô„ÅãÔºü")
        print("   (Êé®Â•®: „Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ‰æùÂ≠òÈñ¢‰øÇÁ´∂Âêà„ÇíÈÅø„Åë„Çã„Åü„ÇÅ)")
        
        # CIÁí∞Â¢É„ÉÅ„Çß„ÉÉ„ÇØ
        ciÁí∞Â¢É = CIÁí∞Â¢É„ÉÅ„Çß„ÉÉ„ÇØ()
        if ciÁí∞Â¢É:
            print("ü§ñ CIÁí∞Â¢É„ÇíÊ§úÂá∫ - Ëá™ÂãïÂÆüË°å„É¢„Éº„Éâ„ÅßÂãï‰Ωú„Åó„Åæ„Åô")
            Ëá™ÂãïÂÆüË°å = True
        
        if Ëá™ÂãïÂÆüË°å:
            print("Ëá™ÂãïÂÆüË°å„É¢„Éº„Éâ: ‰ªÆÊÉ≥Áí∞Â¢É„Çí‰ΩúÊàê„Åó„Åæ„Åô")
            return ‰ªÆÊÉ≥Áí∞Â¢ÉÊñ∞Ë¶è‰ΩúÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
        
        ÂõûÁ≠î = ÂÆâÂÖ®„Å™input("‰ªÆÊÉ≥Áí∞Â¢É„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÅãÔºü (y/n): ", "y", ciÁí∞Â¢É)
        if ÂõûÁ≠î in ['y', 'yes']:
            return ‰ªÆÊÉ≥Áí∞Â¢ÉÊñ∞Ë¶è‰ΩúÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
        else:
            print("‚è≠Ô∏è  „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„ÅßÂÆüË°å„Åó„Åæ„ÅôÔºàÈùûÊé®Â•®Ôºâ")
            return „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´()
    
    # Êó¢Â≠ò‰ªÆÊÉ≥Áí∞Â¢É„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏„ÉÅ„Çß„ÉÉ„ÇØ„Å®„Ç§„É≥„Çπ„Éà„Éº„É´
    return ‰ªÆÊÉ≥Áí∞Â¢É„Éë„ÉÉ„Ç±„Éº„Ç∏ÁÆ°ÁêÜ(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)

def ‰ªÆÊÉ≥Áí∞Â¢ÉÊñ∞Ë¶è‰ΩúÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str) -> bool:
    """Êñ∞Ë¶è‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê„Å®„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó"""
    print(f"\n[SETUP] ‰ªÆÊÉ≥Áí∞Â¢É„Çí‰ΩúÊàê‰∏≠...")
    
    try:
        # ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê
        venv.create(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, with_pip=True)
        print(f"[OK] ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàêÂÆå‰∫Ü: {‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}")
        
        # Â∞ë„ÅóÂæÖÊ©üÔºà‰ªÆÊÉ≥Áí∞Â¢ÉÂàùÊúüÂåñ„ÅÆ„Åü„ÇÅÔºâ
        time.sleep(1)
        
        # ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖ„Åß„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´
        return ‰ªÆÊÉ≥Áí∞Â¢É„Éë„ÉÉ„Ç±„Éº„Ç∏ÁÆ°ÁêÜ(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
        
    except Exception as e:
        print(f"[NG] ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàêÂ§±Êïó: {e}")
        print(f"[HINT] ÊâãÂãï„Åß‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ:")
        if platform.system() == "Windows":
            print(f"python -m venv {‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}")
            print(f"{‰ªÆÊÉ≥Áí∞Â¢É„Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éû„É≥„ÉâÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)}")
        else:
            print(f"python3 -m venv {‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ}")
            print(f"{‰ªÆÊÉ≥Áí∞Â¢É„Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éû„É≥„ÉâÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)}")
        return False

def ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜç‰ΩúÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str) -> bool:
    """Á†¥Êêç„Åó„Åü‰ªÆÊÉ≥Áí∞Â¢É„ÅÆÂÜç‰ΩúÊàê"""
    import shutil
    print(f"üóëÔ∏è  Êó¢Â≠ò„ÅÆ‰ªÆÊÉ≥Áí∞Â¢É„ÇíÂâäÈô§‰∏≠...")
    
    try:
        shutil.rmtree(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
        print(f"[OK] ÂâäÈô§ÂÆå‰∫Ü")
        return ‰ªÆÊÉ≥Áí∞Â¢ÉÊñ∞Ë¶è‰ΩúÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
    except Exception as e:
        print(f"[NG] ÂâäÈô§Â§±Êïó: {e}")
        return False

def ‰ªÆÊÉ≥Áí∞Â¢É„Éë„ÉÉ„Ç±„Éº„Ç∏ÁÆ°ÁêÜ(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ: str) -> bool:
    """‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖ„Åß„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏ÁÆ°ÁêÜ"""
    print(f"\n[PKG] ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖ„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...")
    
    # ‰ªÆÊÉ≥Áí∞Â¢É„ÅÆPythonÂÆüË°å„Éï„Ç°„Ç§„É´„Éë„ÇπÂèñÂæó
    venv_python = ‰ªÆÊÉ≥Áí∞Â¢ÉPythonÂÆüË°å„Éï„Ç°„Ç§„É´ÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
    
    if not os.path.exists(venv_python):
        print(f"[NG] ‰ªÆÊÉ≥Áí∞Â¢É„ÅÆPythonÂÆüË°å„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: {venv_python}")
        return False
    
    print(f"[OK] ‰ªÆÊÉ≥Áí∞Â¢ÉPython: {venv_python}")
    
    # ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏ÂÆöÁæ©
    ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏ = ['pandas', 'requests', 'requests_cache', 'tqdm']
    „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏ = ['aiohttp', 'nltk']
    
    # ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖ„Åß„Éë„ÉÉ„Ç±„Éº„Ç∏„ÉÅ„Çß„ÉÉ„ÇØ
    „Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å = []
    for „Éë„ÉÉ„Ç±„Éº„Ç∏ in ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏:
        try:
            # ‰ªÆÊÉ≥Áí∞Â¢ÉÂÜÖ„Åß„Éë„ÉÉ„Ç±„Éº„Ç∏Á¢∫Ë™ç
            ÁµêÊûú = subprocess.run([
                venv_python, "-c", f"import {„Éë„ÉÉ„Ç±„Éº„Ç∏}"
            ], capture_output=True, text=True)
            
            if ÁµêÊûú.returncode == 0:
                print(f"  [OK] {„Éë„ÉÉ„Ç±„Éº„Ç∏} - „Ç§„É≥„Çπ„Éà„Éº„É´Ê∏à„Åø")
            else:
                print(f"  [NG] {„Éë„ÉÉ„Ç±„Éº„Ç∏} - Êú™„Ç§„É≥„Çπ„Éà„Éº„É´")
                „Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å.append(„Éë„ÉÉ„Ç±„Éº„Ç∏)
        except Exception:
            print(f"  [NG] {„Éë„ÉÉ„Ç±„Éº„Ç∏} - Êú™„Ç§„É≥„Çπ„Éà„Éº„É´")
            „Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å.append(„Éë„ÉÉ„Ç±„Éº„Ç∏)
    
    # ÂøÖË¶Å„Å´Âøú„Åò„Å¶„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´
    if „Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å:
        print(f"\n[PKG] {len(„Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å)}ÂÄã„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí‰ªÆÊÉ≥Áí∞Â¢É„Å´„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Åæ„Åô...")
        
        try:
            # pip„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ
            print("[PKG] pip„ÇíÊúÄÊñ∞Áâà„Å´„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ‰∏≠...")
            subprocess.run([
                venv_python, "-m", "pip", "install", "--upgrade", "pip"
            ], check=True, capture_output=True)
            
            # ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´
            print(f"[PKG] ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´‰∏≠: {', '.join(„Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å)}")
            subprocess.run([
                venv_python, "-m", "pip", "install"
            ] + „Ç§„É≥„Çπ„Éà„Éº„É´ÂøÖË¶Å, check=True, capture_output=True)
            
            print("[OK] ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´ÂÆå‰∫Ü")
            
        except subprocess.CalledProcessError as e:
            print("[NG] „Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")
            print(f"„Ç®„É©„ÉºË©≥Á¥∞: {e}")
            return False
    else:
        print("[OK] ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅØÂÖ®„Å¶„Ç§„É≥„Çπ„Éà„Éº„É´Ê∏à„Åø„Åß„Åô")
    
    # „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆÊèêÊ°à
    „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´ = []
    for „Éë„ÉÉ„Ç±„Éº„Ç∏ in „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏:
        try:
            ÁµêÊûú = subprocess.run([
                venv_python, "-c", f"import {„Éë„ÉÉ„Ç±„Éº„Ç∏}"
            ], capture_output=True, text=True)
            
            if ÁµêÊûú.returncode == 0:
                print(f"  [OK] {„Éë„ÉÉ„Ç±„Éº„Ç∏} - „Ç§„É≥„Çπ„Éà„Éº„É´Ê∏à„ÅøÔºàÈ´òÈÄüÂåñÊ©üËÉΩ„ÅåÂà©Áî®ÂèØËÉΩÔºâ")
            else:
                „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´.append(„Éë„ÉÉ„Ç±„Éº„Ç∏)
        except Exception:
            „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´.append(„Éë„ÉÉ„Ç±„Éº„Ç∏)
    
    if „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´:
        print(f"\n[HINT] È´òÈÄüÂåñ„ÅÆ„Åü„ÇÅ„ÄÅ„Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´„ÇíÊé®Â•®„Åó„Åæ„Åô:")
        for „Éë„ÉÉ„Ç±„Éº„Ç∏ in „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´:
            if „Éë„ÉÉ„Ç±„Éº„Ç∏ == 'aiohttp':
                print(f"  - {„Éë„ÉÉ„Ç±„Éº„Ç∏}: DOIËß£Ê±∫„Åå8ÂÄçÈ´òÈÄüÂåñÔºà‰∏¶ÂàóÂá¶ÁêÜÔºâ")
            elif „Éë„ÉÉ„Ç±„Éº„Ç∏ == 'nltk':
                print(f"  - {„Éë„ÉÉ„Ç±„Éº„Ç∏}: „Ç≠„Éº„ÉØ„Éº„ÉâÂàÜÊûê„ÅåÈ´òÁ≤æÂ∫¶ÂåñÔºàÂìÅË©ûËß£ÊûêÔºâ")
        
        try:
            ciÁí∞Â¢É = CIÁí∞Â¢É„ÉÅ„Çß„ÉÉ„ÇØ()
            ÂõûÁ≠î = ÂÆâÂÖ®„Å™input("\n„Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Åæ„Åô„ÅãÔºü (y/n): ", "y", ciÁí∞Â¢É)
            if ÂõûÁ≠î in ['y', 'yes']:
                print(f"[PKG] „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´‰∏≠...")
                subprocess.run([
                    venv_python, "-m", "pip", "install"
                ] + „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´, check=True, capture_output=True)
                print("[OK] „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´ÂÆå‰∫Ü")
                
                # NLTK„É™„ÇΩ„Éº„Çπ„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                if 'nltk' in „Ç™„Éó„Ç∑„Éß„É≥Êú™„Ç§„É≥„Çπ„Éà„Éº„É´:
                    print("üìö NLTKËøΩÂä†„É™„ÇΩ„Éº„Çπ„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏≠...")
                    try:
                        subprocess.run([
                            venv_python, "-c", 
                            "import nltk; nltk.download('punkt', quiet=True); nltk.download('averaged_perceptron_tagger_eng', quiet=True); nltk.download('wordnet', quiet=True)"
                        ], check=True, capture_output=True)
                        print("[OK] NLTKËøΩÂä†„É™„ÇΩ„Éº„ÇπÂÆå‰∫Ü")
                    except Exception as e:
                        print(f"[WARN]  NLTKËøΩÂä†„É™„ÇΩ„Éº„Çπ„ÅÆ‰∏ÄÈÉ®„Åß„Ç®„É©„Éº: {e}")
            else:
                print("‚è≠Ô∏è  „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åó„Åü")
        except (KeyboardInterrupt, EOFError):
            print("\nü§ñ Ëá™ÂãïÂÆüË°å„É¢„Éº„Éâ: „Ç™„Éó„Ç∑„Éß„É≥„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åó„Åü")
    
    return True

def „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´() -> bool:
    """„Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„Åß„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´ÔºàÈùûÊé®Â•®Ôºâ"""
    print("\n[WARN]  „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„Åß„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Åæ„ÅôÔºàÈùûÊé®Â•®Ôºâ")
    ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏ = ['pandas', 'requests', 'requests_cache', 'tqdm']
    
    try:
        subprocess.check_call([
            sys.executable, '-m', 'pip', 'install', '--user'
        ] + ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏)
        print("[OK] „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„Åß„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´ÂÆå‰∫Ü")
        return True
    except subprocess.CalledProcessError as e:
        print("[NG] „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„Åß„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´Â§±Êïó")
        print("[HINT] ÊâãÂãï„Åß„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Å¶„Åè„Å†„Åï„ÅÑ:")
        print(f"pip install --user {' '.join(ÂøÖÈ†à„Éë„ÉÉ„Ç±„Éº„Ç∏)}")
        return False

def „Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê():
    """ÂøÖË¶Å„Å™„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊàê"""
    ÂøÖË¶Å„Éá„Ç£„É¨„ÇØ„Éà„É™ = ['JSON_folder', 'md_folder', 'PDF']
    
    print(f"\n[DIR] Âá∫Âäõ„Éá„Ç£„É¨„ÇØ„Éà„É™„Çí‰ΩúÊàê‰∏≠...")
    for „Éá„Ç£„É¨„ÇØ„Éà„É™ in ÂøÖË¶Å„Éá„Ç£„É¨„ÇØ„Éà„É™:
        if not os.path.exists(„Éá„Ç£„É¨„ÇØ„Éà„É™):
            os.makedirs(„Éá„Ç£„É¨„ÇØ„Éà„É™)
            print(f"  [DIR] {„Éá„Ç£„É¨„ÇØ„Éà„É™}/ „Çí‰ΩúÊàê")
        else:
            print(f"  [OK] {„Éá„Ç£„É¨„ÇØ„Éà„É™}/ Êó¢Â≠ò")

def ÂÖ•Âäõ„Éï„Ç°„Ç§„É´Á¢∫Ë™ç():
    """ÂÖ•ÂäõCSV„Éï„Ç°„Ç§„É´„ÅÆÂ≠òÂú®Á¢∫Ë™ç"""
    print(f"\n[FILE] ÂÖ•Âäõ„Éï„Ç°„Ç§„É´„Çí„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...")
    
    work_dir = os.getcwd()
    csv_files = [f for f in os.listdir(work_dir) 
                 if f.endswith('.csv') and f != 'scopus_combined.csv']
    
    if csv_files:
        print(f"  [OK] {len(csv_files)}‰ª∂„ÅÆCSV„Éï„Ç°„Ç§„É´„ÇíÁô∫Ë¶ã:")
        for csv_file in csv_files[:3]:
            print(f"    - {csv_file}")
        if len(csv_files) > 3:
            print(f"    - ... ‰ªñ{len(csv_files)-3}‰ª∂")
        return True
    else:
        print(f"  [NG] CSV„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì")
        print(f"  üìù ‰ΩøÁî®ÊñπÊ≥ï:")
        print(f"    1. ‰ΩúÊ•≠„Éï„Ç©„É´„ÉÄ„Çí‰ΩúÊàê")
        print(f"    2. Scopus CSV„Éï„Ç°„Ç§„É´„ÇíÈÖçÁΩÆ")
        print(f"    3. python setup_improved.py „ÇíÂÆüË°å")
        return False

def ÂÆüË°å‰æãË°®Á§∫():
    """ÂÆüË°å‰æã„ÇíË°®Á§∫"""
    print(f"\n[START] „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÂÆå‰∫ÜÔºÅ‰ª•‰∏ã„ÅÆ„Ç≥„Éû„É≥„Éâ„ÅßÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ:")
    print(f"")
    
    ‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ = ".venv"
    
    if os.path.exists(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ):
        print(f"# [OK] ‰ªÆÊÉ≥Áí∞Â¢É„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü")
        
        „Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éû„É≥„Éâ = ‰ªÆÊÉ≥Áí∞Â¢É„Ç¢„ÇØ„ÉÜ„Ç£„Éô„Éº„Ç∑„Éß„É≥„Ç≥„Éû„É≥„ÉâÂèñÂæó(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ)
        
        print(f"# üìç „ÉØ„É≥„Ç≥„Éû„É≥„ÉâÂÖ®Ëá™ÂãïÂÆüË°åÔºàÊé®Â•®Ôºâ")
        ÂÆüË°å„Ç≥„Éû„É≥„Éâ = ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„ÉâÁîüÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "python ÂÖ®Ëá™ÂãïÂÆüË°å.py" if platform.system() == "Windows" else "python3 ÂÖ®Ëá™ÂãïÂÆüË°å.py")
        print(f"{ÂÆüË°å„Ç≥„Éû„É≥„Éâ}")
        print(f"")
        
        print(f"# üìç „Çπ„ÉÜ„ÉÉ„Éó„Éê„Ç§„Çπ„ÉÜ„ÉÉ„ÉóÂÆüË°å")
        if platform.system() == "Windows":
            „Çπ„ÉÜ„ÉÉ„ÉóÂÆüË°å„Ç≥„Éû„É≥„Éâ = ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„ÉâÁîüÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "python core\\scopusËß£Êûê.py")
        else:
            „Çπ„ÉÜ„ÉÉ„ÉóÂÆüË°å„Ç≥„Éû„É≥„Éâ = ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„ÉâÁîüÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "python3 core/scopusËß£Êûê.py")
        print(f"{„Çπ„ÉÜ„ÉÉ„ÉóÂÆüË°å„Ç≥„Éû„É≥„Éâ}")
        print(f"")
        
        print(f"# üìç PDFÂèñÂæó")
        if platform.system() == "Windows":
            PDFÂÆüË°å„Ç≥„Éû„É≥„Éâ = ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„ÉâÁîüÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "python pdf_tools\\PDFÂèñÂæó.py")
        else:
            PDFÂÆüË°å„Ç≥„Éû„É≥„Éâ = ‰ªÆÊÉ≥Áí∞Â¢ÉÂÆüË°å„Ç≥„Éû„É≥„ÉâÁîüÊàê(‰ªÆÊÉ≥Áí∞Â¢É„Éë„Çπ, "python3 pdf_tools/PDFÂèñÂæó.py")
        print(f"{PDFÂÆüË°å„Ç≥„Éû„É≥„Éâ}")
        
        print(f"\n[HINT] Ê¨°Âõû„Åã„Çâ„ÅØ‰ª•‰∏ã„ÅÆ„Ç≥„Éû„É≥„Éâ„ÅßÁ∞°ÂçòÂÆüË°å:")
        print(f"{ÂÆüË°å„Ç≥„Éû„É≥„Éâ}")
    else:
        print(f"# [WARN]  „Ç∑„Çπ„ÉÜ„É†Áí∞Â¢É„ÅßÂÆüË°å")
        if platform.system() == "Windows":
            print(f"python ÂÖ®Ëá™ÂãïÂÆüË°å.py")
            print(f"python core\\scopusËß£Êûê.py")
            print(f"python pdf_tools\\PDFÂèñÂæó.py")
        else:
            print(f"python3 ÂÖ®Ëá™ÂãïÂÆüË°å.py")
            print(f"python3 core/scopusËß£Êûê.py")
            print(f"python3 pdf_tools/PDFÂèñÂæó.py")

def main():
    """„É°„Ç§„É≥Âá¶ÁêÜ"""
    print("[TARGET] ScopusÊñáÁåÆÂèØË¶ñÂåñ„Ç∑„Çπ„ÉÜ„É† - ÊîπËâØÁâàËá™Âãï„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó")
    print("=" * 60)
    print("‚ú® Ê©üËÉΩ: ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê‚Üí„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´‚Üí„Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê„Çí‰∏ÄÂõû„ÅßÂÆå‰∫Ü")
    print("=" * 60)
    
    # „Ç≥„Éû„É≥„Éâ„É©„Ç§„É≥ÂºïÊï∞„ÉÅ„Çß„ÉÉ„ÇØ
    Ëá™ÂãïÂÆüË°å = len(sys.argv) > 1 and sys.argv[1] == "--auto"
    
    # Python „Éê„Éº„Ç∏„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØ
    if sys.version_info < (3, 8):
        print("[NG] Python 3.8‰ª•‰∏ä„ÅåÂøÖË¶Å„Åß„Åô")
        print(f"ÁèæÂú®„ÅÆ„Éê„Éº„Ç∏„Éß„É≥: {sys.version}")
        print("[HINT] Python 3.7„ÅØ2023Âπ¥6Êúà„Åß„Çµ„Éù„Éº„ÉàÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü")
        sys.exit(1)
    else:
        print(f"[OK] Python {sys.version_info.major}.{sys.version_info.minor} ÂØæÂøú")
    
    # OSÁ¢∫Ë™ç
    print(f"[OK] OS: {platform.system()}")
    
    # ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê„Å®„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´Ôºà‰∏ÄÂõû„ÅßÂÆå‰∫ÜÔºâ
    if not ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê„Åä„Çà„Å≥Ë®≠ÂÆö(Ëá™ÂãïÂÆüË°å=Ëá™ÂãïÂÆüË°å):
        print("[NG] ‰ªÆÊÉ≥Áí∞Â¢É„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")
        sys.exit(1)
    
    # „Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê
    „Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê()
    
    # ÂÖ•Âäõ„Éï„Ç°„Ç§„É´Á¢∫Ë™ç
    ÂÖ•Âäõ„Éï„Ç°„Ç§„É´Á¢∫Ë™ç()
    
    # ÂÆüË°å‰æãË°®Á§∫
    ÂÆüË°å‰æãË°®Á§∫()
    
    print(f"\n[DONE] ÊîπËâØÁâà„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÂÆå‰∫ÜÔºÅ")
    print(f"[HINT] ‰ªÆÊÉ≥Áí∞Â¢É‰ΩúÊàê„Åã„Çâ„Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´„Åæ„Åß‰∏ÄÂõû„ÅßÂÆå‰∫Ü„Åó„Åæ„Åó„Åü")

if __name__ == "__main__":
    main()
